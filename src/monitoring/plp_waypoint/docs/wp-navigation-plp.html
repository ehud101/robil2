<html>

<head>
  <style media="screen">
    body {
      max-width: 680px;
      margin: auto;
      font-family: "Helvetica Nueue", "Lucida Sans", Arial, sans-serif;
    }
    h2 {
      border-bottom: 1px solid gray;
    }
    .new {
      background-color: #FFFFAA;
    }
  </style>
</head>

<body>

	<h1 id="wpnavigationplp">WP Navigation PLP</h1>

	<ul>
		<li>v1 2015&#8211;01&#8211;12</li>
		<li>v2 2015&#8211;01&#8211;28</li>
		<li>v3 2015&#8211;05&#8211;18 Updated to reflect the python code and the recent presentations.</li>
		<li>v4 2015&#8211;09&#8211;21 Added monitoring, and rearranged &#8220;trigger&#8221;, &#8220;monitoring&#8221; and &#8220;goal&#8221; to be under &#8220;Lifecycle&#8221;</li>
	</ul>

	<h2 id="about">About</h2>

	<p>This PLP calculates the success probability of navigating to the end of a local path.</p>

	<h2 id="values">Values</h2>

	<h3 id="parameters">Parameters</h3>

	<ul>
		<li>
			<code>map</code> &larr;
			<code>/PER/MiniMap</code> occupancy grid of the area. Message is
			<code>Map.msg</code>.</li>
		<li>
			<code>path</code> &larr;
			<code>/PP/Path</code> planned path. Message type is
			<code>robil_msgs/Path</code>
		</li>
		<li>
			<code>position</code> &larr;
			<code>/Loc/Pose</code> global position. Message type is
			<code>PoseWithCovarianceStamped</code>.</li>
		<li>
			<code>positionError</code> &larr;
			<code>/Loc/Pose</code> (obtained from the covariance component of
			<code>position</code>)</li>
		<li>
			<code>mapError</code> &larr;
			<code>TBD</code> Current assume map error=0. Error will become interesting when we use visual data.</li>
	</ul>

	<h3 id="variables">Variables</h3>

	<ul>
		<li>
			<code>distanceToWaypoint</code> local path length to WP</li>
		<li>
			<code>mapOccupancy</code> percentage of occupied cells in MiniMap</li>
		<li>
			<code>heightVariablity</code> height variability in
			<code>map</code>
		</li>
	</ul>

	<h3 id="constants">Constants</h3>

	<ul>
		<li>
			<code>MIN_LOC_ERROR</code> Minimal error under which it is unsafe to drive</li>
		<li>
			<code>BOBCAT_SIZE</code> Size of the bobcat</li>
		<li>
			<code>MIN_BLADE_CLEARANCE</code> Minimal blade clearance for driving</li>
		<li>
			<code>FUEL_CONSUMPTION_RATE</code>
		</li>
		<li>
			<code>BOBCAT_AVERAGE_SPEED</code>
		</li>
	</ul>

	<h2 id="naturalpreconditions">Natural Preconditions</h2>

	<ul>
		<li>
			<code>bladeDof[0] in ([x,y]...) and bladeDof[1] in ([x,y]....) and bladeDof[2] in ([x,y]...)</code>

			<ul>
				<li>Ensuring that the IBEO can see the road</li>
			</ul>
		</li>
	</ul>

	<h2 id="applicationcontext">Application Context</h2>

	<h3 id="resources">Resources</h3>

	<ul>
		<li>Rover (exclusive)</li>
	</ul>

	<h3 id="preconditions">Preconditions</h3>

	<ul>
		<li>
			<code>distanceToWaypoint &gt; 1m</code>
		</li>
		<li>
			<code>positionError &lt; MIN_LOC_ERROR</code>
		</li>
	</ul>

	<h3 id="concurrencyconditions">Concurrency Conditions</h3>

	<p>
		<em>Later, we will replace this with &#8220;natural&#8221; PLP for the entire system. That PLP will maintain an &#8220;everything is OK&#8221; statement</em>
	</p>

	<ul>
		<li>
			<code>Bobcat_OK</code>
		</li>
		<li>
			<code>IBEO_OK</code>
		</li>
		<li>
			<code>INS_OK</code>
		</li>
		<li>
			<code>positionError &lt; MIN_LOC_ERROR</code>
		</li>
		<li>
			<code>Map_OK</code>
		</li>
		<li>
			<code>bladeClearance &gt; MIN_BLADE_CLEARANCE</code>
		</li>
	</ul>

	<h3 id="concurrentmodules">Concurrent Modules</h3>

	<ul>
		<li>blade minimum height preserver</li>
	</ul>

	<h2 id="sideeffects">Side Effects</h2>

	<ul>
		<li>Fuel:
			<code>FUEL_CONSUMPTION_RATE * distanceToWaypoint * (heightVariablity * hvFactor)</code>
		</li>
	</ul>

  <div class="new">

    <h2 id="lifecyclenew">Lifecycle (new!)</h2>

  	<h3 id="trigger">Trigger</h3>

  	<ul>
  		<li>Nav task active</li>
  		<li>Received local path</li>
  		<li>Enough data already gathered (minimap, position, etc.)</li>
  	</ul>

  	<h3 id="monitoring">Monitoring</h3>

  	<ul>
  		<li>Remaining path length
  			<em>(English: Sample
  				<code>distanceToWaypoint</code> every 10 seconds. Expect a decrease.)</em>
  		</li>
  		<li>Every:
  			<code>10 sec</code>
  		</li>
  		<li>Expect:
  			<code>decrease( distanceToWaypoint )</code>
  		</li>
  	</ul>

  	<h3 id="goal">Goal</h3>

  	<ul>
  		<li>
  			<code>distanceToWaypoint &lt; 1m</code>
  		</li>
  	</ul>
  </div>

	<h2 id="result">Result</h2>

	<p>
		<em>The calculation result describes the probabilities and time for each known outcome: success, and various types of failures.</em>
	</p>

	<ul>
		<li>success</li>
		<li>probability:
			<code>(explicit subset of the PLP parameters)</code>
		</li>
		<li>time</li>
		<li>failures</li>
		<li>
			<code>Bobcat_stuck</code>:

			<ul>
				<li>probability:
					<code>(explicit subset of the PLP parameters)</code>
				</li>
				<li>time:
					<code>(explicit subset of the PLP parameters)</code>
				</li>
			</ul>
		</li>
		<li>
			<code>Bobcat_turned_over</code>:

			<ul>
				<li>probability:
					<code>(explicit subset of the PLP parameters)</code>
				</li>
				<li>time:
					<code>(explicit subset of the PLP parameters)</code>
				</li>
			</ul>
		</li>
		<li>confidence
			<code>A number in the range of 0..1</code>
		</li>
	</ul>

	<h2 id="robilintegration">Robil Integration</h2>

	<h3 id="abort">Abort</h3>

	<ul>
		<li>Getting a new local path</li>
	</ul>

	<h3 id="pauseresume">Pause/Resume</h3>

	<ul>
		<li>Pausing and resuming tasks according to the task manager.</li>
	</ul>

	<h3 id="output">Output</h3>

	<p>Send a message describing a result to a ROS topic. Exact details TBD.</p>
</body>

</html>
